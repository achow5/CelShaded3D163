<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title>CMPM163 Final: 3D Cel Shading</title>
		<link href="https://fonts.googleapis.com/css?family=Roboto+Mono&display=swap" rel="stylesheet">
		<style>
			html {
				font-family: 'Roboto Mono', monospace;
				text-align: center;
			}
			body {margin: 0;}
			canvas { display: block; }

		</style>
	</head>
	<body>
		<p>Press X or C to load the scene. X  loads cel-shaded and outlined models. C loads phong-shaded models. You can switch between them by pressing X or C again. </p>
		<script src="../three.js-master/build/three.js"></script>
		<script src="../three.js-master/examples/js/loaders/GLTFLoader.js"></script>
		<script src="../three.js-master/examples/js/effects/OutlineEffect.js"></script>
		<script>
		var scene = new THREE.Scene();
		var camera = new THREE.PerspectiveCamera(8,window.innerWidth/window.innerHeight, 0.4, 1000);
		var renderer = new THREE.WebGLRenderer();
		var outlineEffect = new THREE.OutlineEffect(renderer,{
			defaultThickness: 0.005,
			defaultColor: [0,0,0]
		});
		var celShaded = true;
		document.onkeypress = function(event){
			var x = event.key;
			if(x == 'x'){
				while(scene.children.length > 0){
					scene.remove(scene.children[0]);
				}
				celShaded = true;
				console.log(celShaded);
				init(celShaded);
			}else if(x == 'c'){
				while(scene.children.length > 0){
					scene.remove(scene.children[0]);
				}
				celShaded = false;
				console.log(celShaded);
				init(celShaded);
			}
		}

		function init(celShaded){
      camera.rotateX(0.05);
      camera.rotateY(1.44);
      camera.rotateZ(-0.05);
      renderer.setSize(window.innerWidth, window.innerHeight);
			renderer.setClearColor(0xBDBDBD, 1.0);
      document.body.appendChild(renderer.domElement);
      camera.position.set(100, 9, 10);
	  	camera.lookAt(scene.position);
			// materials
			if(celShaded == true){
				var blueMaterial = new THREE.MeshToonMaterial({color: 0x4287f5});
				var redMaterial = new THREE.MeshToonMaterial( { color: 0xe32d36 });
				var whiteMaterial = new THREE.MeshToonMaterial({color:0xFFFFFF});
			}else if(celShaded == false){
				var blueMaterial = new THREE.MeshPhongMaterial( { color: 0x4287f5 });
				var redMaterial = new THREE.MeshPhongMaterial( { color: 0xe32d36 });
				var whiteMaterial = new THREE.MeshPhongMaterial({color:0xFFFFFF});
			}




			var light = new THREE.PointLight(0xffffff, 1, 1000);
			light.position.set(50, 50, 50);
			scene.add(light);
			var mesh1;
			var mesh2;
			var loader = new THREE.GLTFLoader();
			// material used is MeshToonMaterial.js found in Three.js examples
			// MeshPhongMaterial is used to show regular shading
			loader.load('CMPM163_Group_2_Right.gltf', function (gltf) { // first model, blue fighter
				mesh1 = gltf.scene.children[0];
				mesh1.position.x=0;
				mesh1.position.y = -10;
				mesh1.scale.x = 1;
				mesh1.traverse((o) => {
					if (o.isMesh)	o.material = blueMaterial;
					});
				scene.add(mesh1);
			}, function (xhr) {
				console.log((xhr.loaded / xhr.total * 100) + '% loaded' );
			}, function (error) {
				console.error(error);
			});

			loader.load('CMPM163_Group_2_Left.gltf', function (gltf) { // second model, red fighter
				mesh2 = gltf.scene.children[0];
				mesh2.position.x=0;
				mesh2.position.y = -10;
				mesh2.scale.x = 1;
				mesh2.traverse((o) => {
					if (o.isMesh) o.material = redMaterial;
					//if (o.isMesh) o.material = new THREE.MeshPhongMaterial( { color: 0x4287f5 });
				});
				scene.add(mesh2);
			}, function (xhr) {
				console.log((xhr.loaded / xhr.total * 100) + '% loaded' );
			}, function (error) {
				console.error(error);
			});

			loader.load('CMPM163_Group_2_Cube.gltf', function (gltf) { // Stage, but it doesn't show up for some reason
				mesh3 = gltf.scene.children[0];
				mesh3.position.x=0;
				mesh3.position.y = -10.2;
				mesh3.traverse((o)=> {
					if(o.isMesh) o.material = whiteMaterial;
				});
				scene.add(mesh3);
			}, function (xhr) {
				console.log((xhr.loaded / xhr.total * 100) + '% loaded' );
			}, function (error) {
				console.error(error);
			});

			// Adds in an cartoonish outline effect, where we can change parameters like thickness and color
			// must be rendered to show up in the final code
			function animate() {
				requestAnimationFrame(animate);
				// rotates the models to demonstrate how the lighting effect works
				var timer = Date.now() * .0005;
				mesh1.rotation.y = timer;
				mesh2.rotation.y = timer;
				mesh3.rotation.y = timer;
				camera.lookAt(scene.position);
				renderer.render(scene, camera);
				if(celShaded == true){
					outlineEffect.render(scene, camera);
				}
			}

			animate();
		}
		</script>
	</body>
</html>
