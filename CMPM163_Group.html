<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title>CMPM163 Final: 3D Cel Shading</title>
		<style>
			body { margin: 0; }
			canvas { display: block; }
		</style>
	</head>
	<body>
		<script src="../three.js-master/build/three.js"></script>
		<script src="../three.js-master/examples/js/loaders/GLTFLoader.js"></script>
		<script src="../three.js-master/examples/js/effects/OutlineEffect.js"></script>
		<script>
      var scene = new THREE.Scene();
      var camera = new THREE.PerspectiveCamera(8,window.innerWidth/window.innerHeight, 0.4, 1000);
      camera.rotateX(0.05);
      camera.rotateY(1.44);
      camera.rotateZ(-0.05);
      var renderer = new THREE.WebGLRenderer();
      renderer.setSize(window.innerWidth, window.innerHeight);
			renderer.setClearColor(0xBDBDBD, 1.0);
      document.body.appendChild(renderer.domElement);
      camera.position.set(100, 9, 10);
	  	//camera.position.x = 100;
      //camera.position.y = 9;
      //camera.position.z = 10;
	  	camera.lookAt(scene.position);

			var light = new THREE.PointLight(0xffffff, 1, 1000);
			light.position.set(50, 50, 50);
			scene.add(light);
			var mesh1;
			var mesh2;
			var loader = new THREE.GLTFLoader();

			// material used is MeshToonMaterial.js found in Three.js examples
			// MeshPhongMaterial is used to show regular shading
			loader.load('CMPM163_Group_2_Right.gltf', function (gltf) { // first model, blue fighter
				mesh1 = gltf.scene.children[0];
				mesh1.position.x=0;
				mesh1.position.y = -10;
				mesh1.scale.x = 1;
				mesh1.traverse((o) => {
					if (o.isMesh) o.material = new THREE.MeshToonMaterial( { color: 0x4287f5 });
					//if (o.isMesh) o.material = new THREE.MeshPhongMaterial( { color: 0x4287f5 });
				});
				scene.add(mesh1);
			}, function (xhr) {
				console.log((xhr.loaded / xhr.total * 100) + '% loaded' );
			}, function (error) {
				console.error(error);
			});

			loader.load('CMPM163_Group_2_Left.gltf', function (gltf) { // second model, red fighter
				mesh2 = gltf.scene.children[0];
				mesh2.position.x=0;
				mesh2.position.y = -10;
				mesh2.scale.x = 1;
				mesh2.traverse((o) => {
					if (o.isMesh) o.material = new THREE.MeshToonMaterial( { color: 0xe32d36 });
					//if (o.isMesh) o.material = new THREE.MeshPhongMaterial( { color: 0x4287f5 });
				});
				scene.add(mesh2);
			}, function (xhr) {
				console.log((xhr.loaded / xhr.total * 100) + '% loaded' );
			}, function (error) {
				console.error(error);
			});

			loader.load('CMPM163_Group_2_Cube.gltf', function (gltf) { // Stage, but it doesn't show up for some reason
				gltf.scene.position.x=0;
				gltf.scene.scale.x = 1;
				scene.add(gltf.scene);
			}, function (xhr) {
				console.log((xhr.loaded / xhr.total * 100) + '% loaded' );
			}, function (error) {
				console.error(error);
			});
			// Adds in an cartoonish outline effect, where we can change parameters like thickness and color
			// must be rendered to show up in the final code
			var outlineEffect = new THREE.OutlineEffect(renderer,{
				defaultThickness: 0.005,
				defaultColor: [0,0,0]
			});
			function animate() {
				requestAnimationFrame(animate);
				// rotates the models to demonstrate how the lighting effect works
				var timer = Date.now() * .0005;
				mesh1.rotation.y = timer;
				mesh2.rotation.y = timer;
				camera.lookAt(scene.position);

				renderer.render(scene, camera);
				outlineEffect.render(scene, camera);
			}

			animate();
		</script>
	</body>
</html>
